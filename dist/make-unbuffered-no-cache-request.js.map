{"version":3,"sources":["../src/make-unbuffered-no-cache-request.js"],"names":["makeUnbufferedNoCacheRequest","options","url","logger","superagent","get","agent","retry","retries","shouldRetry","set","process","env","GAE_SERVICE","GAE_VERSION","timeout"],"mappings":";;;;;;;AACA;;AAGA;;;;AAGA;;;;;;;;;;AAUO,MAAMA,4BAA4B,GAAG,CACxCC,OADwC,EAExCC,GAFwC,EAGxCC,MAHwC,KAKxCC,oBACKC,GADL,CACSH,GADT,EAEKI,KAFL,CAEWL,OAAO,CAACK,KAFnB;AAGI;;;;;;;;AAHJ,CAWKC,KAXL,CAWWN,OAAO,CAACO,OAXnB,EAW4B,sCAAgBL,MAAhB,EAAwBF,OAAO,CAACQ,WAAhC,CAX5B;AAYI;;;;;;;AAZJ,CAmBKC,GAnBL,CAoBQ,YApBR,EAqBS,GAAEC,OAAO,CAACC,GAAR,CAAYC,WAAZ,IAA2B,wBAAyB,KAAIF,OAAO,CAC7DC,GADsD,CAClDE,WADkD,IACnC,SAAU,GAtB1C,EAwBKC,OAxBL,CAwBad,OAAO,CAACc,OAxBrB,CALG","sourcesContent":["// @flow\nimport superagent from \"superagent\";\nimport type {Request} from \"superagent\";\nimport type {RequestOptions} from \"./types.js\";\nimport {makeShouldRetry} from \"./make-should-retry.js\";\nimport type {Logger} from \"./shared/index.js\";\n\n/**\n * Make a request for a given URL without buffering or caching.\n *\n * This is not intended for direct use. Use makeRequest.\n *\n * @param {RenderGatewayOptions} options The options used to start the gateway.\n * @param {string} url The URL to be requested.\n * @param {Logger} logger The logger to use.\n * @returns {SuperAgentRequest} A superagent request for the URL.\n */\nexport const makeUnbufferedNoCacheRequest = (\n    options: RequestOptions,\n    url: string,\n    logger: Logger,\n): Request =>\n    superagent\n        .get(url)\n        .agent(options.agent)\n        /**\n         * Configure retries since superagent can handle this for us.\n         * We give it a callback so we can log the retry and, if we so choose\n         * in the future, decide whether we should allow any more. This would\n         * allow us to short circuit the retry count (the max retries still\n         * takes precedence over our callback response, so we can't retry\n         * forever).\n         */\n        .retry(options.retries, makeShouldRetry(logger, options.shouldRetry))\n        /**\n         * We add a user agent header so that we can easily identify our\n         * requests in logs.\n         *\n         * The header has a form like:\n         *     GAE_SERVICE_STRING_HERE (GAE_VERSION_STRING_HERE)\n         */\n        .set(\n            \"User-Agent\",\n            `${process.env.GAE_SERVICE || \"unnamed-render-gateway\"} (${process\n                .env.GAE_VERSION || \"UNKNOWN\"})`,\n        )\n        .timeout(options.timeout);\n"],"file":"make-unbuffered-no-cache-request.js"}