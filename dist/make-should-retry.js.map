{"version":3,"sources":["../src/make-should-retry.js"],"names":["makeShouldRetry","logger","override","err","res","warn","status"],"mappings":";;;;;;;AAGA;;;;;;;;AAEA;;;;;;;;;AASO,MAAMA,eAAe,GAAG,CAC3BC,MAD2B,EAE3BC,QAF2B,KAGT;AAClB,SAAO,CAACC,GAAD,EAAsBC,GAAtB,KAA4D;AAC/DH,IAAAA,MAAM,CAACI,IAAP,CAAY,8BAAZ,oBACO,yBAAaF,GAAb,CADP;AAEIG,MAAAA,MAAM,EAAEF,GAAG,CAACE;AAFhB;AAKA;;;;;;;;;;;;AAWA,WAAOJ,QAAP,aAAOA,QAAP,uBAAOA,QAAQ,CAAGC,GAAH,EAAQC,GAAR,CAAf;AACH,GAlBD;AAmBH,CAvBM","sourcesContent":["// @flow\nimport type {Response as SuperAgentResponse, CallbackHandler} from \"superagent\";\nimport type {Logger, AmbiguousError} from \"./shared/index.js\";\nimport {extractError} from \"./shared/index.js\";\n\n/**\n * Create a shouldRetry callback for use with superagent's retry() method.\n *\n * @param {Logger} logger The logger that will record the retry.\n * @param {CallbackHandler} [override] A callback that might override the\n * default behavior.\n * @returns {CallbackHandler} A superagent callback handler to use with the\n * retry() function.\n */\nexport const makeShouldRetry = (\n    logger: Logger,\n    override: ?CallbackHandler,\n): CallbackHandler => {\n    return (err: AmbiguousError, res: SuperAgentResponse): ?boolean => {\n        logger.warn(\"Request failed. Might retry.\", {\n            ...extractError(err),\n            status: res.status,\n        });\n\n        /**\n         * According to https://github.com/visionmedia/superagent/blob/0de12b299d5d5b5ec05cc43e18e853a95bffb25a/src/request-base.js#L181-L206\n         *\n         * Returning a non-boolean value causes superagent to do its default\n         * behavior, which is:\n         * - allow retry for all 500 errors except 501\n         * - allow retry for err.code set to any:\n         *      ['ECONNRESET', 'ETIMEDOUT', 'EADDRINFO', 'ESOCKETTIMEDOUT']\n         * - allow retry if err.timeout is truthy and err.code is 'ECONNABORTED`\n         * - allow retry if err.crossDomain is truthy\n         */\n        return override?.(err, res);\n    };\n};\n"],"file":"make-should-retry.js"}