{"version":3,"file":"make-request-middleware.js","names":["makeRequestMiddleware","mode","logger","lw","express","makeMiddleware","Promise","resolve","expressWinston","level","winstonInstance","expressFormat","colorize","meta"],"sources":["../../../src/shared/middleware/make-request-middleware.js"],"sourcesContent":["// @flow\nimport * as lw from \"@google-cloud/logging-winston\";\nimport expressWinston from \"express-winston\";\n\nimport type {Middleware, $Request, $Response} from \"express\";\nimport type {Logger, Runtime} from \"../types.js\";\n\n/**\n * Create middleware for tracking requests.\n */\nexport const makeRequestMiddleware = <TReq: $Request, TRes: $Response>(\n    mode: Runtime,\n    logger: Logger,\n): Promise<Middleware<TReq, TRes>> => {\n    if (mode === \"production\") {\n        /**\n         * In production, we're using the Google logging-winston middleware.\n         * This adds the log property to the request, allowing us to associate\n         * log entries with a request trace, if the request is being traced.\n         */\n        return lw.express.makeMiddleware(logger);\n    }\n\n    /**\n     * In all other cases, we use express-winston to log requests for us.\n     */\n    return Promise.resolve(\n        expressWinston.logger({\n            /**\n             * Specify the level that this logger logs at.\n             * (use a function to dynamically change level based on req and res)\n             *     `function(req, res) { return String; }`\n             */\n            level: \"info\",\n\n            /**\n             * Use the logger we already set up.\n             */\n            winstonInstance: logger,\n            expressFormat: true,\n            colorize: true,\n            meta: false,\n        }),\n    );\n};\n"],"mappings":";;;;;;AACA;AACA;AAA6C;AAAA;AAAA;;AAK7C;AACA;AACA;AACO,MAAMA,qBAAqB,GAAG,CACjCC,IAAa,EACbC,MAAc,KACoB;EAClC,IAAID,IAAI,KAAK,YAAY,EAAE;IACvB;AACR;AACA;AACA;AACA;IACQ,OAAOE,EAAE,CAACC,OAAO,CAACC,cAAc,CAACH,MAAM,CAAC;EAC5C;;EAEA;AACJ;AACA;EACI,OAAOI,OAAO,CAACC,OAAO,CAClBC,uBAAc,CAACN,MAAM,CAAC;IAClB;AACZ;AACA;AACA;AACA;IACYO,KAAK,EAAE,MAAM;IAEb;AACZ;AACA;IACYC,eAAe,EAAER,MAAM;IACvBS,aAAa,EAAE,IAAI;IACnBC,QAAQ,EAAE,IAAI;IACdC,IAAI,EAAE;EACV,CAAC,CAAC,CACL;AACL,CAAC;AAAC"}