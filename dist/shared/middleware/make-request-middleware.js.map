{"version":3,"file":"make-request-middleware.js","names":["makeRequestMiddleware","mode","logger","lw","express","makeMiddleware","Promise","resolve","expressWinston","level","winstonInstance","expressFormat","colorize","meta"],"sources":["../../../src/shared/middleware/make-request-middleware.js"],"sourcesContent":["// @flow\nimport * as lw from \"@google-cloud/logging-winston\";\nimport expressWinston from \"express-winston\";\n\nimport type {Middleware, $Request, $Response} from \"express\";\nimport type {Logger, Runtime} from \"../types.js\";\n\n/**\n * Create middleware for tracking requests.\n */\nexport const makeRequestMiddleware = <TReq: $Request, TRes: $Response>(\n    mode: Runtime,\n    logger: Logger,\n): Promise<Middleware<TReq, TRes>> => {\n    if (mode === \"production\") {\n        /**\n         * In production, we're using the Google logging-winston middleware.\n         * This adds the log property to the request, allowing us to associate\n         * log entries with a request trace, if the request is being traced.\n         */\n        return lw.express.makeMiddleware(logger);\n    }\n\n    /**\n     * In all other cases, we use express-winston to log requests for us.\n     */\n    return Promise.resolve(\n        expressWinston.logger({\n            /**\n             * Specify the level that this logger logs at.\n             * (use a function to dynamically change level based on req and res)\n             *     `function(req, res) { return String; }`\n             */\n            level: \"info\",\n\n            /**\n             * Use the logger we already set up.\n             */\n            winstonInstance: logger,\n            expressFormat: true,\n            colorize: true,\n            meta: false,\n        }),\n    );\n};\n"],"mappings":";;;;;;;AACA;;AACA;;;;;;;;AAKA;AACA;AACA;AACO,MAAMA,qBAAqB,GAAG,CACjCC,IADiC,EAEjCC,MAFiC,KAGC;EAClC,IAAID,IAAI,KAAK,YAAb,EAA2B;IACvB;AACR;AACA;AACA;AACA;IACQ,OAAOE,EAAE,CAACC,OAAH,CAAWC,cAAX,CAA0BH,MAA1B,CAAP;EACH;EAED;AACJ;AACA;;;EACI,OAAOI,OAAO,CAACC,OAAR,CACHC,wBAAeN,MAAf,CAAsB;IAClB;AACZ;AACA;AACA;AACA;IACYO,KAAK,EAAE,MANW;;IAQlB;AACZ;AACA;IACYC,eAAe,EAAER,MAXC;IAYlBS,aAAa,EAAE,IAZG;IAalBC,QAAQ,EAAE,IAbQ;IAclBC,IAAI,EAAE;EAdY,CAAtB,CADG,CAAP;AAkBH,CAlCM"}