{"version":3,"sources":["../../src/shared/get-app-engine-request-id.js"],"names":["getAppEngineRequestID","req","requestID","header","suffixIndex","length","maybeBadSuffix","substring","startsWith"],"mappings":";;;;;;;AAGA;AACA;AACA;AACO,MAAMA,qBAAqB,GAAIC,GAAD,IAA4B;AAC7D,QAAMC,SAAS,GAAGD,GAAG,CAACE,MAAJ,CAAW,4BAAX,CAAlB;;AACA,MAAID,SAAS,IAAI,IAAjB,EAAuB;AACnB,WAAO,IAAP;AACH;AAED;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACI,QAAME,WAAW,GAAGF,SAAS,CAACG,MAAV,GAAmB,CAAvC;AACA,QAAMC,cAAc,GAAGJ,SAAS,CAACK,SAAV,CAAoBH,WAApB,CAAvB;;AAEA,MAAIE,cAAc,CAACE,UAAf,CAA0B,QAA1B,CAAJ,EAAyC;AACrC,WAAON,SAAS,CAACK,SAAV,CAAoB,CAApB,EAAuBH,WAAvB,IAAsC,QAA7C;AACH;;AACD,SAAOF,SAAP;AACH,CAtBM","sourcesContent":["// @flow\nimport type {$Request} from \"express\";\n\n/**\n * Get the GAE request ID for a given request if it exists.\n */\nexport const getAppEngineRequestID = (req: $Request): ?string => {\n    const requestID = req.header(\"X-Appengine-Request-Log-Id\");\n    if (requestID == null) {\n        return null;\n    }\n\n    /**\n     * Per https://github.com/Khan/webapp/blob/57b38a92b5ac8ca912252aa41f3e37e6a9e486fa/web/request/request_id.py#L27-L55\n     * the requestID could be incorrect. Though it's likely that Google fixed\n     * this by now, let's keep the hack as it is harmless and will address the\n     * issue if it remains.\n     *\n     * The \"bad\" suffixes are all of the form 000101xx and need to be changed to\n     * 000100.\n     */\n    const suffixIndex = requestID.length - 8;\n    const maybeBadSuffix = requestID.substring(suffixIndex);\n\n    if (maybeBadSuffix.startsWith(\"000101\")) {\n        return requestID.substring(0, suffixIndex) + \"000100\";\n    }\n    return requestID;\n};\n"],"file":"get-app-engine-request-id.js"}