{"version":3,"file":"get-app-engine-request-id.js","names":["getAppEngineRequestID","req","requestID","header","suffixIndex","length","maybeBadSuffix","substring","startsWith"],"sources":["../../src/shared/get-app-engine-request-id.js"],"sourcesContent":["// @flow\nimport type {$Request} from \"express\";\n\n/**\n * Get the GAE request ID for a given request if it exists.\n */\nexport const getAppEngineRequestID = (req: $Request): ?string => {\n    const requestID = req.header(\"X-Appengine-Request-Log-Id\");\n    if (requestID == null) {\n        return null;\n    }\n\n    /**\n     * Per https://github.com/Khan/webapp/blob/57b38a92b5ac8ca912252aa41f3e37e6a9e486fa/web/request/request_id.py#L27-L55\n     * the requestID could be incorrect. Though it's likely that Google fixed\n     * this by now, let's keep the hack as it is harmless and will address the\n     * issue if it remains.\n     *\n     * The \"bad\" suffixes are all of the form 000101xx and need to be changed to\n     * 000100.\n     */\n    const suffixIndex = requestID.length - 8;\n    const maybeBadSuffix = requestID.substring(suffixIndex);\n\n    if (maybeBadSuffix.startsWith(\"000101\")) {\n        return requestID.substring(0, suffixIndex) + \"000100\";\n    }\n    return requestID;\n};\n"],"mappings":";;;;;;AAGA;AACA;AACA;AACO,MAAMA,qBAAqB,GAAIC,GAAa,IAAc;EAC7D,MAAMC,SAAS,GAAGD,GAAG,CAACE,MAAM,CAAC,4BAA4B,CAAC;EAC1D,IAAID,SAAS,IAAI,IAAI,EAAE;IACnB,OAAO,IAAI;EACf;;EAEA;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;EACI,MAAME,WAAW,GAAGF,SAAS,CAACG,MAAM,GAAG,CAAC;EACxC,MAAMC,cAAc,GAAGJ,SAAS,CAACK,SAAS,CAACH,WAAW,CAAC;EAEvD,IAAIE,cAAc,CAACE,UAAU,CAAC,QAAQ,CAAC,EAAE;IACrC,OAAON,SAAS,CAACK,SAAS,CAAC,CAAC,EAAEH,WAAW,CAAC,GAAG,QAAQ;EACzD;EACA,OAAOF,SAAS;AACpB,CAAC;AAAC"}