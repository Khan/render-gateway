{"version":3,"file":"trace.js","names":["trace","action","message","requestOrLogger","tracer","traceAgent","get","safeHasOwnProperty","logger","getLogger","traceImpl"],"sources":["../../src/shared/trace.js"],"sourcesContent":["// @flow\nimport * as traceAgent from \"@google-cloud/trace-agent\";\nimport type {$Request} from \"express\";\nimport {getLogger} from \"./get-logger.js\";\nimport {traceImpl} from \"./trace-impl.js\";\nimport {safeHasOwnProperty} from \"./safe-has-own-property.js\";\n\nimport type {Logger, RequestWithLog, ITraceSession} from \"./types.js\";\n\ninterface ITrace {\n    /**\n     * Start tracing an event.\n     *\n     * This will log the start of a trace and open a trace session, which is\n     * returned. Use the returned session to end the trace when the traced event is\n     * over. The traced event will be logged and also written to the Google Cloud\n     * StackDriver Trace agent.\n     *\n     * Note that if startTraceAgent was never called, this will still log but the\n     * StackDriver trace span creation will not actually happen.\n     *\n     * @param {string} action The name of the action being traced.\n     * @param {string} message A message to be logged along side the action\n     * @param {TReq: RequestWithLog<$Request>} [request] The request being\n     * fulfilled. This is used to determine if a request-scoped logger can be used.\n     * @returns {ITraceSession} The new trace session that was created and is to be\n     * used to end the session.\n     */\n    <TReq: RequestWithLog<$Request>>(\n        action: string,\n        message: string,\n        request?: TReq,\n    ): ITraceSession;\n\n    /**\n     * Start tracing an event.\n     *\n     * This will log the start of a trace and open a trace session, which is\n     * returned. Use the returned session to end the trace when the traced event is\n     * over. The traced event will be logged and also written to the Google Cloud\n     * StackDriver Trace agent.\n     *\n     * Note that if startTraceAgent was never called, this will still log but the\n     * StackDriver trace span creation will not actually happen.\n     *\n     * @param {string} action The name of the action being traced.\n     * @param {string} message A message to be logged along side the action\n     * @param {Logger} logger The logger to be used for the trace.\n     * @returns {ITraceSession} The new trace session that was created and is to be\n     * used to end the session.\n     */\n    (action: string, message: string, logger: Logger): ITraceSession;\n}\n\nexport const trace: ITrace = (\n    action: string,\n    message: string,\n    requestOrLogger: any,\n): ITraceSession => {\n    const tracer = traceAgent.get();\n    if (requestOrLogger == null || safeHasOwnProperty(requestOrLogger, \"url\")) {\n        const logger = getLogger(requestOrLogger);\n        return traceImpl(logger, action, message, tracer);\n    }\n    return traceImpl(requestOrLogger, action, message, tracer);\n};\n"],"mappings":";;;;;;AACA;AAEA;AACA;AACA;AAA8D;AAAA;;AAiDvD,MAAMA,KAAa,GAAG,CACzBC,MAAc,EACdC,OAAe,EACfC,eAAoB,KACJ;EAChB,MAAMC,MAAM,GAAGC,UAAU,CAACC,GAAG,EAAE;EAC/B,IAAIH,eAAe,IAAI,IAAI,IAAI,IAAAI,sCAAkB,EAACJ,eAAe,EAAE,KAAK,CAAC,EAAE;IACvE,MAAMK,MAAM,GAAG,IAAAC,oBAAS,EAACN,eAAe,CAAC;IACzC,OAAO,IAAAO,oBAAS,EAACF,MAAM,EAAEP,MAAM,EAAEC,OAAO,EAAEE,MAAM,CAAC;EACrD;EACA,OAAO,IAAAM,oBAAS,EAACP,eAAe,EAAEF,MAAM,EAAEC,OAAO,EAAEE,MAAM,CAAC;AAC9D,CAAC;AAAC"}