{"version":3,"file":"use-app-engine-middleware.js","names":["useAppEngineMiddleware","app","mode","logger","express","use","makeRequestMiddleware","makeAppEngineRequestIDMiddleware","makeErrorMiddleware"],"sources":["../../src/shared/use-app-engine-middleware.js"],"sourcesContent":["// @flow\nimport express from \"express\";\nimport type {$Application, $Request, $Response} from \"express\";\nimport {makeErrorMiddleware} from \"./middleware/make-error-middleware.js\";\nimport {makeRequestMiddleware} from \"./middleware/make-request-middleware.js\";\nimport {makeAppEngineRequestIDMiddleware} from \"./middleware/make-app-engine-request-id-middleware.js\";\n\nimport type {Logger, Runtime} from \"./types.js\";\n\n/**\n * Apply the middleware that we want to use with Google App Engine (GAE).\n */\nexport async function useAppEngineMiddleware<TReq: $Request, TRes: $Response>(\n    app: $Application<TReq, TRes>,\n    mode: Runtime,\n    logger: Logger,\n): Promise<$Application<TReq, TRes>> {\n    return (\n        express<TReq, TRes>()\n            // Add the request logging middleware.\n            .use(await makeRequestMiddleware(mode, logger))\n            // Add requestID middleware\n            .use(makeAppEngineRequestIDMiddleware(logger))\n            // Add the app.\n            .use(app)\n            // Add the error logging middleware.\n            .use(makeErrorMiddleware(logger))\n    );\n}\n"],"mappings":";;;;;;;AACA;;AAEA;;AACA;;AACA;;;;AAIA;AACA;AACA;AACO,eAAeA,sBAAf,CACHC,GADG,EAEHC,IAFG,EAGHC,MAHG,EAI8B;EACjC,OACI,IAAAC,gBAAA,IACI;EADJ,CAEKC,GAFL,CAES,MAAM,IAAAC,4CAAA,EAAsBJ,IAAtB,EAA4BC,MAA5B,CAFf,EAGI;EAHJ,CAIKE,GAJL,CAIS,IAAAE,kEAAA,EAAiCJ,MAAjC,CAJT,EAKI;EALJ,CAMKE,GANL,CAMSJ,GANT,EAOI;EAPJ,CAQKI,GARL,CAQS,IAAAG,wCAAA,EAAoBL,MAApB,CART,CADJ;AAWH"}