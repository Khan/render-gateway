{"version":3,"file":"make-common-service-router.js","names":["makeCommonServiceRouter","version","warmUpHandler","Router","get","req","res","send","next","headers"],"sources":["../../../src/ka-shared/routes/make-common-service-router.js"],"sourcesContent":["// @flow\nimport {Router} from \"express\";\nimport asyncHandler from \"express-async-handler\";\n\nimport type {$Request, $Response, NextFunction} from \"express\";\nimport type {WarmUpHandlerFn} from \"../types.js\";\nimport type {RequestWithLog} from \"../../shared/index.js\";\n\n/**\n * Make the router to handle the /_api routes.\n *\n * Takes the version string to be returned via the /_api/version route.\n */\nexport const makeCommonServiceRouter = <Req: $Request, Res: $Response>(\n    version: string,\n    warmUpHandler: ?WarmUpHandlerFn,\n): express$Router<Req, Res> =>\n    new Router<Req, Res>()\n        .get(\"/_api/ping\", (req: Req, res: Res) => {\n            res.send(\"pong\\n\");\n        })\n        .get(\"/_api/version\", (req: Req, res: Res) => {\n            res.send({version});\n        })\n        .get(\n            \"/_ah/warmup\",\n            asyncHandler(\n                async (\n                    req: RequestWithLog<Req>,\n                    res: Res,\n                    next: NextFunction,\n                ) => {\n                    await warmUpHandler?.(req.headers);\n                    res.send(\"OK\\n\");\n                },\n            ),\n        );\n"],"mappings":";;;;;;;AACA;;AACA;;;;AAMA;AACA;AACA;AACA;AACA;AACO,MAAMA,uBAAuB,GAAG,CACnCC,OADmC,EAEnCC,aAFmC,KAInC,IAAIC,eAAJ,GACKC,GADL,CACS,YADT,EACuB,CAACC,GAAD,EAAWC,GAAX,KAAwB;EACvCA,GAAG,CAACC,IAAJ,CAAS,QAAT;AACH,CAHL,EAIKH,GAJL,CAIS,eAJT,EAI0B,CAACC,GAAD,EAAWC,GAAX,KAAwB;EAC1CA,GAAG,CAACC,IAAJ,CAAS;IAACN;EAAD,CAAT;AACH,CANL,EAOKG,GAPL,CAQQ,aARR,EASQ,kCACI,OACIC,GADJ,EAEIC,GAFJ,EAGIE,IAHJ,KAIK;EACD,OAAMN,aAAN,aAAMA,aAAN,uBAAMA,aAAa,CAAGG,GAAG,CAACI,OAAP,CAAnB;EACAH,GAAG,CAACC,IAAJ,CAAS,MAAT;AACH,CARL,CATR,CAJG"}