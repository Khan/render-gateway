{"version":3,"file":"make-common-service-router.js","names":["_express","require","_expressAsyncHandler","_interopRequireDefault","obj","__esModule","default","makeCommonServiceRouter","version","warmUpHandler","Router","get","req","res","send","asyncHandler","next","headers","exports"],"sources":["../../../src/ka-shared/routes/make-common-service-router.js"],"sourcesContent":["// @flow\nimport {Router} from \"express\";\nimport asyncHandler from \"express-async-handler\";\n\nimport type {$Request, $Response, NextFunction} from \"express\";\nimport type {WarmUpHandlerFn} from \"../types.js\";\nimport type {RequestWithLog} from \"../../shared/index.js\";\n\n/**\n * Make the router to handle the /_api routes.\n *\n * Takes the version string to be returned via the /_api/version route.\n */\nexport const makeCommonServiceRouter = <Req: $Request, Res: $Response>(\n    version: string,\n    warmUpHandler: ?WarmUpHandlerFn,\n): express$Router<Req, Res> =>\n    new Router<Req, Res>()\n        .get(\"/_api/ping\", (req: Req, res: Res) => {\n            res.send(\"pong\\n\");\n        })\n        .get(\"/_api/version\", (req: Req, res: Res) => {\n            res.send({version});\n        })\n        .get(\n            \"/_ah/warmup\",\n            asyncHandler(\n                async (\n                    req: RequestWithLog<Req>,\n                    res: Res,\n                    next: NextFunction,\n                ) => {\n                    await warmUpHandler?.(req.headers);\n                    res.send(\"OK\\n\");\n                },\n            ),\n        );\n"],"mappings":";;;;;;AACA,IAAAA,QAAA,GAAAC,OAAA;AACA,IAAAC,oBAAA,GAAAC,sBAAA,CAAAF,OAAA;AAAiD,SAAAE,uBAAAC,GAAA,WAAAA,GAAA,IAAAA,GAAA,CAAAC,UAAA,GAAAD,GAAA,KAAAE,OAAA,EAAAF,GAAA;AAMjD;AACA;AACA;AACA;AACA;AACO,MAAMG,uBAAuB,GAAGA,CACnCC,OAAe,EACfC,aAA+B,KAE/B,IAAIC,eAAM,EAAY,CACjBC,GAAG,CAAC,YAAY,EAAE,CAACC,GAAQ,EAAEC,GAAQ,KAAK;EACvCA,GAAG,CAACC,IAAI,CAAC,QAAQ,CAAC;AACtB,CAAC,CAAC,CACDH,GAAG,CAAC,eAAe,EAAE,CAACC,GAAQ,EAAEC,GAAQ,KAAK;EAC1CA,GAAG,CAACC,IAAI,CAAC;IAACN;EAAO,CAAC,CAAC;AACvB,CAAC,CAAC,CACDG,GAAG,CACA,aAAa,EACb,IAAAI,4BAAY,EACR,OACIH,GAAwB,EACxBC,GAAQ,EACRG,IAAkB,KACjB;EACD,OAAMP,aAAa,aAAbA,aAAa,uBAAbA,aAAa,CAAGG,GAAG,CAACK,OAAO,CAAC;EAClCJ,GAAG,CAACC,IAAI,CAAC,MAAM,CAAC;AACpB,CAAC,CACJ,CACJ;AAACI,OAAA,CAAAX,uBAAA,GAAAA,uBAAA"}