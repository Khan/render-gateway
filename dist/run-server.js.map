{"version":3,"sources":["../src/run-server.js"],"names":["runServer","options","app","use","process","env","GAE_VERSION","get","req","res","send","url","gatewayOptions","mode","logger"],"mappings":";;;;;;;AACA;;AAEA;;AAGA;;AACA;;;;;;;;;;AAEA;;;AAGO,MAAMA,SAAS,GAAIC,OAAD,IAAyC;AAC9D;AACA;AACA;AACA,QAAMC,GAAG,GAAG,wBACPC,GADO;AAEJ;;;;AAIA,uCACIC,OAAO,CAACC,GAAR,CAAYC,WAAZ,IAA2B,kBAD/B,CANI,EAUPC,GAVO,CAUH,IAVG,EAUG,OAAOC,GAAP,EAAYC,GAAZ,KAAoB;AAC3BA,IAAAA,GAAG,CAACC,IAAJ,CAAU,6BAA4BF,GAAG,CAACG,GAAI,EAA9C;AACH,GAZO,CAAZ,CAJ8D,CAkB9D;;AACA,QAAMC,cAA8B;AAChCC,IAAAA,IAAI,EAAE,qCAD0B;AAEhCC,IAAAA,MAAM,EAAE;AAFwB,KAG7Bb,OAH6B,CAApC;;AAKA,2BAAkDW,cAAlD,EAAkEV,GAAlE;AACH,CAzBM","sourcesContent":["// @flow\nimport express from \"express\";\nimport type {$Request, $Response} from \"express\";\nimport {startGateway} from \"./shared/index.js\";\nimport type {RenderGatewayOptions} from \"./types.js\";\nimport type {GatewayOptions, RequestWithLog} from \"./shared/index.js\";\nimport {getLogger, makeCommonServiceRouter} from \"./ka-shared/index.js\";\nimport {getRuntimeMode} from \"./ka-shared/get-runtime-mode.js\";\n\n/**\n * Run the render-gateway server using the provided options.\n */\nexport const runServer = (options: RenderGatewayOptions): void => {\n    // TODO: Do a real server.\n    //   For now, we just handle all gets and return a response that is the\n    //   url that was requested.\n    const app = express<RequestWithLog<$Request>, $Response>()\n        .use(\n            /**\n             * This sets up the /_api/ route handlers that are used by the KA\n             * deployment system.\n             */\n            makeCommonServiceRouter(\n                process.env.GAE_VERSION || \"fake-dev-version\",\n            ),\n        )\n        .get(\"/*\", async (req, res) => {\n            res.send(`The URL you requested was ${req.url}`);\n        });\n\n    // Start the gateway.\n    const gatewayOptions: GatewayOptions = {\n        mode: getRuntimeMode(),\n        logger: getLogger(),\n        ...options,\n    };\n    startGateway<RequestWithLog<$Request>, $Response>(gatewayOptions, app);\n};\n"],"file":"run-server.js"}