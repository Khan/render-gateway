{"version":3,"file":"get-request-authentication.js","names":["_wonderStuffCore","require","_wonderStuffServer","_getSecrets","getRequestAuthentication","authentication","cryptoKeyPath","headerName","secretKey","deprecatedSecretKey","secrets","getSecrets","secret","deprecatedSecret","KindError","Errors","NotFound","exports"],"sources":["../src/get-request-authentication.js"],"sourcesContent":["// @flow\nimport {KindError} from \"@khanacademy/wonder-stuff-core\";\nimport {Errors} from \"@khanacademy/wonder-stuff-server\";\nimport type {ServerOptions} from \"@khanacademy/wonder-stuff-server\";\nimport {getSecrets} from \"./get-secrets.js\";\nimport type {AuthenticationOptions} from \"./types.js\";\n\n/**\n * Get the request authentication options for the service.\n *\n * Given the authentication options, this will load the secrets file, decrypt\n * it, and return the values needed for request authentication in a format\n * compatible with wonder-stuff-server.\n *\n * @param {AuthenticationOptions} authentication The authentication options\n * for the service.\n * @returns {Promise<?ServerOptions[\"requestAuthentication\"]>} The promise of\n * the request authentication values.\n */\nexport const getRequestAuthentication = async (\n    authentication: AuthenticationOptions,\n): Promise<ServerOptions[\"requestAuthentication\"]> => {\n    const {cryptoKeyPath, headerName, secretKey, deprecatedSecretKey} =\n        authentication;\n    const secrets = await getSecrets(cryptoKeyPath);\n    const secret = secrets[secretKey];\n    const deprecatedSecret =\n        deprecatedSecretKey == null ? secret : secrets[deprecatedSecretKey];\n    if (secret == null) {\n        /**\n         * We don't check if the deprecated secret is set or not. If it isn't\n         * that's not a critical error.\n         */\n        throw new KindError(\"Unable to load secret\", Errors.NotFound);\n    }\n    return {\n        headerName,\n        secret,\n        deprecatedSecret,\n    };\n};\n"],"mappings":";;;;;;AACA,IAAAA,gBAAA,GAAAC,OAAA;AACA,IAAAC,kBAAA,GAAAD,OAAA;AAEA,IAAAE,WAAA,GAAAF,OAAA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACO,MAAMG,wBAAwB,GAAG,MACpCC,cAAqC,IACa;EAClD,MAAM;IAACC,aAAa;IAAEC,UAAU;IAAEC,SAAS;IAAEC;EAAmB,CAAC,GAC7DJ,cAAc;EAClB,MAAMK,OAAO,GAAG,MAAM,IAAAC,sBAAU,EAACL,aAAa,CAAC;EAC/C,MAAMM,MAAM,GAAGF,OAAO,CAACF,SAAS,CAAC;EACjC,MAAMK,gBAAgB,GAClBJ,mBAAmB,IAAI,IAAI,GAAGG,MAAM,GAAGF,OAAO,CAACD,mBAAmB,CAAC;EACvE,IAAIG,MAAM,IAAI,IAAI,EAAE;IAChB;AACR;AACA;AACA;IACQ,MAAM,IAAIE,0BAAS,CAAC,uBAAuB,EAAEC,yBAAM,CAACC,QAAQ,CAAC;EACjE;EACA,OAAO;IACHT,UAAU;IACVK,MAAM;IACNC;EACJ,CAAC;AACL,CAAC;AAACI,OAAA,CAAAb,wBAAA,GAAAA,wBAAA"}