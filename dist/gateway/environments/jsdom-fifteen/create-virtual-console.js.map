{"version":3,"sources":["../../../../src/gateway/environments/jsdom-fifteen/create-virtual-console.js"],"names":["createVirtualConsole","logger","virtualConsole","VirtualConsole","on","e","message","indexOf","simplifiedError","error","args","warn","info","debug"],"mappings":";;;;;;;AACA;;AACA;;AAGA;;;;;;AAMO,MAAMA,oBAAoB,GAAIC,MAAD,IAAoC;AACpE,QAAMC,cAAc,GAAG,IAAIC,qBAAJ,EAAvB;AACAD,EAAAA,cAAc,CAACE,EAAf,CAAkB,YAAlB,EAAiCC,CAAD,IAAc;AAC1C,QAAIA,CAAC,CAACC,OAAF,CAAUC,OAAV,CAAkB,oBAAlB,KAA2C,CAA/C,EAAkD;AAC9C;AACA;AACA;AACH;;AACD,UAAMC,eAAe,GAAG,yBAAaH,CAAb,CAAxB;AACAJ,IAAAA,MAAM,CAACQ,KAAP,CAAc,SAAQD,eAAe,CAACC,KAAhB,IAAyB,EAAG,EAAlD,EAAqDD,eAArD;AACH,GARD,EAFoE,CAYpE;;AACAN,EAAAA,cAAc,CAACE,EAAf,CAAkB,OAAlB,EAA2B,CAACE,OAAD,EAAU,GAAGI,IAAb,KACvBT,MAAM,CAACQ,KAAP,CAAc,SAAQH,OAAQ,EAA9B,EAAiCI,IAAjC,CADJ;AAGAR,EAAAA,cAAc,CAACE,EAAf,CAAkB,MAAlB,EAA0B,CAACE,OAAD,EAAU,GAAGI,IAAb,KACtBT,MAAM,CAACU,IAAP,CAAa,SAAQL,OAAQ,EAA7B,EAAgCI,IAAhC,CADJ;AAGAR,EAAAA,cAAc,CAACE,EAAf,CAAkB,MAAlB,EAA0B,CAACE,OAAD,EAAU,GAAGI,IAAb,KACtBT,MAAM,CAACW,IAAP,CAAa,SAAQN,OAAQ,EAA7B,EAAgCI,IAAhC,CADJ;AAGAR,EAAAA,cAAc,CAACE,EAAf,CAAkB,KAAlB,EAAyB,CAACE,OAAD,EAAU,GAAGI,IAAb;AACrB;;;;AAIAT,EAAAA,MAAM,CAACW,IAAP,CAAa,SAAQN,OAAQ,EAA7B,EAAgCI,IAAhC,CALJ;AAOAR,EAAAA,cAAc,CAACE,EAAf,CAAkB,OAAlB,EAA2B,CAACE,OAAD,EAAU,GAAGI,IAAb,KACvBT,MAAM,CAACY,KAAP,CAAc,SAAQP,OAAQ,EAA9B,EAAiCI,IAAjC,CADJ;AAGA,SAAOR,cAAP;AACH,CAjCM","sourcesContent":["// @flow\nimport {VirtualConsole} from \"jsdom15\";\nimport {extractError} from \"../../../shared/index.js\";\nimport type {Logger} from \"../../../shared/index.js\";\n\n/**\n * Create a virtual console for use with JSDOM.\n *\n * @param {Logger} logger The logger to which this virtual console logs.\n * @returns {VirtualConsole} A JSDOM VirtualConsole instance.\n */\nexport const createVirtualConsole = (logger: Logger): VirtualConsole => {\n    const virtualConsole = new VirtualConsole();\n    virtualConsole.on(\"jsdomError\", (e: Error) => {\n        if (e.message.indexOf(\"Could not load img\") >= 0) {\n            // We know that images cannot load. We're deliberately blocking\n            // them.\n            return;\n        }\n        const simplifiedError = extractError(e);\n        logger.error(`JSDOM:${simplifiedError.error || \"\"}`, simplifiedError);\n    });\n\n    // NOTE: We pass args array as the metadata parameter for winston log.\n    virtualConsole.on(\"error\", (message, ...args) =>\n        logger.error(`JSDOM:${message}`, args),\n    );\n    virtualConsole.on(\"warn\", (message, ...args) =>\n        logger.warn(`JSDOM:${message}`, args),\n    );\n    virtualConsole.on(\"info\", (message, ...args) =>\n        logger.info(`JSDOM:${message}`, args),\n    );\n    virtualConsole.on(\"log\", (message, ...args) =>\n        /**\n         * Winston uses log for a different, core thing, so let's map log to\n         * info.\n         */\n        logger.info(`JSDOM:${message}`, args),\n    );\n    virtualConsole.on(\"debug\", (message, ...args) =>\n        logger.debug(`JSDOM:${message}`, args),\n    );\n    return virtualConsole;\n};\n"],"file":"create-virtual-console.js"}