{"version":3,"file":"log-request-info-middleware.js","names":["logRequestInfoMiddleware","req","res","next","flattenedHeaders","Object","keys","headers","reduce","key","getLogger","info","url","allHeaders","method"],"sources":["../../../src/gateway/middleware/log-request-info-middleware.js"],"sourcesContent":["// @flow\nimport type {$Response, NextFunction} from \"express\";\nimport {getLogger} from \"../../shared/index.js\";\n\nimport type {Request} from \"../types.js\";\n\n/**\n * Simple middleware that logs some info about the incoming request.\n *\n * We flatten the headers since they give us problems with exporting\n * our info logs to bigquery if we don't. The issue is that we end up\n * with a bigquery column per unique header name, and so we run out of\n * columns.\n */\nexport function logRequestInfoMiddleware<Req: Request, Res: $Response>(\n    req: Req,\n    res: Res,\n    next: NextFunction,\n): void {\n    const flattenedHeaders = Object.keys(req.headers).reduce(\n        (headers, key) => headers + `${key}: ${req.headers[key]}\\n`,\n        \"\",\n    );\n    getLogger(req).info(`Request received: ${req.url}`, {\n        allHeaders: flattenedHeaders,\n        method: req.method,\n        url: req.url,\n    });\n\n    next();\n}\n"],"mappings":";;;;;;AAEA;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACO,SAASA,wBAAwB,CACpCC,GAAQ,EACRC,GAAQ,EACRC,IAAkB,EACd;EACJ,MAAMC,gBAAgB,GAAGC,MAAM,CAACC,IAAI,CAACL,GAAG,CAACM,OAAO,CAAC,CAACC,MAAM,CACpD,CAACD,OAAO,EAAEE,GAAG,KAAKF,OAAO,GAAI,GAAEE,GAAI,KAAIR,GAAG,CAACM,OAAO,CAACE,GAAG,CAAE,IAAG,EAC3D,EAAE,CACL;EACD,IAAAC,gBAAS,EAACT,GAAG,CAAC,CAACU,IAAI,CAAE,qBAAoBV,GAAG,CAACW,GAAI,EAAC,EAAE;IAChDC,UAAU,EAAET,gBAAgB;IAC5BU,MAAM,EAAEb,GAAG,CAACa,MAAM;IAClBF,GAAG,EAAEX,GAAG,CAACW;EACb,CAAC,CAAC;EAEFT,IAAI,EAAE;AACV"}